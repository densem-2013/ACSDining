@model ACSDining.Web.Areas.SU_Area.Models.WeekMenuModel

@{
    ViewBag.Title = "Index";
}

<hr />
    <div class="col-md-9   col-sm-12 col-xs-12 object-non-visible" data-animation-effect="fadeIn">
    <div class="panel panel-default" id="mfwPanel">
        <table>
            <tbody>
                <tr style="background: rgba(86, 86, 89, 0.48)">
                    <td class="col-sm-3">
                        <div>
                            <input type="button" value="Перейти на текущую неделю" id="curweek" class="btn" data-bind=" click:function(){ $root.LoadWeekMenu($root.CurrentWeekNumber())},css:{disabled: $root.IsCurrentWeek()}" />
                        </div>
                    </td>
                    <td class="col-sm-2">
                        <div>
                            <span data-bind="text: ' Неделя ' + WeekNumber()" id="wnDysplay"></span>
                        </div>
                    </td>
                    <td class="col-sm-4">
                        <div>
                            <input type="button" id="btnaddmenu" class="btn" value="Добавить меню на следующую неделю" />
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <table class="table table-striped table-bordered table-responsive table-condensed table-hover" id="updateTable" >
            <thead >
                <tr>
                    <th class="col-sm-1" >День недели</th>
                    <th class="col-sm-2">Категория блюда</th>
                    <th class="col-sm-6">Название</th>
                    <th class="col-sm-2" colspan="2">Стоимость</th>
                    <th class ="col-sm-2">Изменить</th>
                </tr>
            </thead>
            <tbody data-bind="foreach: MFD_models" >
                <tr>
                    <td style="vertical-align: middle; text-align:center">
                        <span data-bind="text: DayOfWeek"></span>
                    </td>
                    <td data-bind="foreach: Dishes">
                        <div style="border-bottom: 1px solid; text-align: right">
                            <span data-bind="text: $data.Category() + ' : '"></span>
                        </div>
                    </td>
                    <td  data-bind="foreach: Dishes" >
                        <div style="border-bottom: 1px solid;">
                            <span data-bind="text: $data.Title"></span>
                            <button type="button" class=" btn-danger btn-xs col-sm-2" data-bind="visible: $parent.Editing, click: function(){$root.showDishes($data,$parentContext.$index())}" style="float:right">Изменить</button>
                        </div>
                    </td>
                    <td data-bind="foreach: Dishes" style=" text-align: right">
                        <div>
                            <span data-bind="text: $data.Price" style=" border-bottom: 1px solid"></span><br />
                        </div>
                    </td>
                    <td style="text-align: right; vertical-align:middle; height:100%">
                        <span data-bind="text: TotalPrice()"></span>
                    </td>
                    <td style="vertical-align: middle; text-align:center">
                        <button class="glyphicon glyphicon-pencil btn-success btn-lg" data-bind="click: Editable " />
                    </td>

                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td style="border-bottom: 1px solid;  border-right: 0" colspan="2"><span class="changesaved" data-bind="visible: ChangeSaved"> Изменения сохранены </span></td>
                    <td style="border-bottom: 1px solid; align-content: stretch; border-left: 0" colspan="2">
                        <input type="button" class="btn btn-success btn-lg" value="Сохранить изменения" data-bind="click: SaveToServer , visible: BeenChanged" />
                        <span style="float: right;"> Итого: </span>
                    </td>
                    <td style="border-bottom: 1px solid; text-align: right" >
                        <span data-bind=" text : SummaryPrice()"></span>
                    </td>
                    <td style="border-bottom: 1px solid;"></td>
                </tr>
                <tr>
                    <td colspan="7">
                        <div class="dataTables_paginate paging_simple_numbers" style="padding:5px;">
                            <ul class="pagination">
                                <li class=" paginate_button previous">
                                    <a href="#" data-bind=" click: function(){ $root.LoadWeekMenu($root.WeekNumber() - 1); }">Previous</a>
                                </li>
                                <li class="paginate_button " data-bind="foreach: NumbersWeeks">
                                    <a href="#" class="paginate_button" data-bind="text: $data, css: { active: $data == $root.WeekNumber()}, click: function(){ $root.LoadWeekMenu($data); }"></a>
                                </li>
                                <li class=" paginate_button next">
                                    <a href="#" data-bind="click: function(){ $root.LoadWeekMenu($root.WeekNumber() + 1 ); }">Next</a>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div id="modalbox" class="modal ">
        <div class="modal-dialog">
            <div class="panel panel-default">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1>Выберите <span data-bind="text:Category"></span> </h1>
                    </div>
                    <div class="modal-body">
                        <table class="table table-condensed table-striped table-bordered pre-scrollable" id="pageTable">
                            <thead>
                                <tr>
                                    <th>№</th>
                                    <th>Название</th>
                                    <th>Стоимость</th>
                                    <th>Выбрать</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach:pagedList">
                                <tr>
                                    <td>
                                        <span data-bind="text: $root.pageIndex() * $root.pageSize() + $index() + 1"></span>
                                    </td>
                                    <td>
                                        <span data-bind="text:Title"></span>
                                    </td>
                                    <td>
                                        <span data-bind="text:Price"></span>
                                    </td>
                                    <td>
                                        <input type="radio" name="dishGroup" data-bind="checked: $root.SelectedDish,checkedValue : DishId, click: $root.changeSelected" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="dataTables_paginate paging_simple_numbers">
                                    <ul class="pagination">
                                        <li data-bind="css: { disabled: pageIndex() === 0 }" class="paginate_button previous">
                                            <a href="#" class="btn" data-bind="click: previousPage">Previous</a>
                                        </li>
                                        <li data-bind=" foreach: allPages">
                                            <a href="#" class="paginate_button" data-bind="text: $data.pageNumber, click: function() { $root.moveToPage($data.pageNumber-1)  }, css: { active: $data.pageNumber === ($root.pageIndex() + 1) }"></a>
                                        </li>
                                        <li class="paginate_button next" data-bind="css: { disabled: pageIndex() === maxPageIndex() }">
                                            <a href="#" data-bind="click: nextPage">Next</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" data-bind="click: applyChanges">Ok</button>
                        <button class="btn btn-default" data-dismiss="modal">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    @*<script src="~/Scripts/knockout.mapping-latest.js" type="text/javascript"></script>*@

    @Scripts.Render("~/bundles/knockoutBind")
    <script type="text/javascript">
        (function () {
            $(".pre-scrollable").css("maxHeight", "700px")
            .parents('.banner-caption').css({ "top": "11%" });

            $("#pageTable").height("350px");
            $("#modalbox").offset({ top: 100 });

            //$(".paginate_button").click(function (event) {
            //    var vm = ko.dataFor(event.target);
            //    $(event.target).addClass("active");
            //});
        })();
    </script>

